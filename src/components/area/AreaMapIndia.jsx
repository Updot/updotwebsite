import React, { useEffect, useImperativeHandle, useRef } from "react";
import { useSelector } from "react-redux";
import classes from "./AreaMap.module.scss";

const AreaMap = React.forwardRef((props, ref) => {
  const arrowCurr = useSelector((state) => state.mouseLocation.currLocation);
  // console.log(arrowCurr);
  const mapRef = useRef(null);

  const animateMap = () => {
    mapRef.current.classList.add(`${classes["area-map-active"]}`);
    setTimeout(() => {
      mapRef.current.classList.add(`${classes["area-map-animate"]}`);
    }, 500);
  };

  const removeAnimation = () => {
    mapRef.current.classList.remove(`${classes["area-map-animate"]}`);
  };

  useImperativeHandle(ref, () => {
    return { animateMap, removeAnimation };
  });

  useEffect(() => {
    const indicator = document.querySelector(`[data-type="indicator"]`);
    const { width, height } = indicator.getBoundingClientRect();
    // if (arrowCurr.x - width * 1.2 < 0) {
    //   indicator.style.left = `${arrowCurr.x - width * 1.2}px`;
    // } else {
    //   indicator.style.left = `${arrowCurr.x - width * 1.2}px`;
    // }
    indicator.style.left = `${arrowCurr.x - width * 1.2}px`;
    indicator.style.top = `${arrowCurr.y - height * 1.2}px`;
  }, [arrowCurr]);

  const onMouseOverHandler = (stateName, event) => {
    document.querySelectorAll(`.${classes["map-loc"]}`).forEach((el) => {
      el.style.fill = `#000`;
      el.style.stroke = `#fff`;
    });
    event.target.style.fill = `#fff`;
    // event.target.style.stroke = `#69b423`;
    const indicator = document.querySelector(`[data-type="indicator"]`);
    indicator.style.opacity = 1;
    const nameContainer = document.querySelector(`[data-type="indicator"] p`);
    nameContainer.innerText = stateName;
  };

  const onMouseOutHandler = () => {
    document.querySelectorAll(`.${classes["map-loc"]}`).forEach((el) => {
      el.style.fill = `#000`;
      el.style.stroke = `#fff`;
      const indicator = document.querySelector(`[data-type="indicator"]`);
      indicator.style.opacity = 0;
    });
  };

  return (
    <div>
      <svg
        ref={mapRef}
        className={classes["area-map"]}
        width="948"
        height="508"
        viewBox="0 0 948 508"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <g id="india-map">
          <path
            id="Path 1251"
            d="M560.583 313.136L559.043 308.316L542.613 302.266L536.433 300.096L534.703 294.166L527.553 293.826L517.163 302.256L508.603 301.846L493.083 296.306L498.123 290.886L463.313 288.676L437.803 294.576L429.493 303.516L421.503 305.696L406.393 303.616L386.943 310.786L389.493 323.636L379.853 327.126L373.363 319.436L362.853 323.876L360.643 335.876L351.663 341.866L342.833 341.746L312.303 355.126L316.873 355.686L347.363 352.236L361.973 346.356L373.083 349.536L382.823 343.646L403.903 342.286L410.243 348.756L426.663 350.696L457.753 338.216L509.543 336.826L542.883 316.776L569.023 311.396L560.583 313.136Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="gj"
            className={classes["map-loc"]}
            onMouseOver={onMouseOverHandler.bind(null, "Gujarat")}
            onMouseOut={onMouseOutHandler}
            d="M168.833 204.806L129.523 197.656L112.153 189.136L107.813 195.276L94.103 195.356L83.673 192.816L66.523 193.846L47.273 186.366L16.263 192.226L16.533 195.706L11.863 202.466L26.293 211.686L53.703 217.616L43.613 222.636L18.683 219.186L12.463 214.876L1.36304 221.786L32.813 253.966L74.793 256.476L101.093 240.946L105.583 242.476L98.743 259.136L84.583 275.736L122.033 270.296L139.123 263.946L145.273 251.676L162.213 248.616L182.233 236.476L162.393 215.866L168.833 204.806Z"
            fill="#000"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1254"
            d="M761.553 282.756L754.953 287.106L742.023 287.736L728.353 301.206L732.573 301.336L726.433 322.846L736.073 324.396L777.223 294.786L770.433 283.986L761.553 282.756Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1255"
            d="M700.423 300.396L728.353 301.206L742.023 287.736L735.233 283.626L701.373 290.666L700.423 300.396Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1256"
            d="M825.533 285.896L838.843 267.576L829.683 266.306L818.783 268.636L780.833 273.476L770.433 283.986L777.223 294.786L796.403 295.246L825.533 285.896Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1257"
            d="M819.783 258.856L799.983 260.556L796.713 271.446L818.783 268.636L829.683 266.306L838.843 267.576L886.953 247.096L857.753 245.856L819.783 258.856Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1258"
            d="M768.823 253.626L754.373 251.516L731.573 254.506L689.403 249.446L681.653 263.276L754.473 269.286L752.583 278.856L753.333 278.996L767.203 270.496L772.253 265.056L763.533 260.456L768.823 253.626Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1259"
            d="M534.673 280.896L542.843 274.516L577.843 276.066L588.143 272.886L592.073 268.656L610.323 266.906L631.183 241.016L643.913 236.256L637.583 230.866L621.043 232.216L575.283 219.096L553.193 216.266L545.383 203.126L530.283 202.736L526.793 208.456L536.413 214.606L522.443 217.716L517.393 223.156L526.323 230.966L523.753 233.736L513.683 233.106L494.223 238.446L485.873 237.296L481.033 241.646L483.963 244.676L480.743 248.996L467.323 257.426L478.073 267.866L482.043 278.606L479.293 281.576L467.103 284.606L463.313 288.676L498.123 290.886L493.083 296.306L508.603 301.846L517.163 302.256L527.553 293.826L534.703 294.166L536.433 300.096L542.613 302.266L548.303 288.586L534.673 280.896Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1260"
            d="M410.243 348.756L403.903 342.286L382.823 343.646L373.083 349.536L361.973 346.356L347.363 352.236L316.873 355.686L301.773 353.826L293.173 337.406L281.973 333.416L293.543 319.066L287.933 315.986L275.903 318.106L265.533 315.856L262.073 309.946L253.713 308.796L239.043 313.916L223.053 313.926L210.223 324.736L197.613 327.316L194.503 330.676L197.533 332.566L193.573 337.286L187.003 338.626L165.373 359.146L166.103 365.416L161.673 369.316L142.453 369.546L135.853 374.056L139.943 375.856L134.783 381.056L121.233 384.286L113.923 392.156L129.503 394.306L129.773 397.796L116.503 400.726L117.053 404.256L139.083 405.656L142.793 421.956L132.353 425.276L137.893 430.316L154.643 426.056L167.153 429.096L184.453 424.586L207.613 426.236L212.513 422.816L223.393 397.356L250.183 385.496L270.333 386.746L321.503 378.906L352.443 366.246L426.663 350.696L410.243 348.756Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="tamil-nadu"
            className={classes["map-loc"]}
            onMouseOver={onMouseOverHandler.bind(null, "Tamil Nadu")}
            onMouseOut={onMouseOutHandler}
            d="M184.453 424.586L167.153 429.096L154.643 426.056L137.893 430.316L132.353 425.276L112.873 424.226L99.8131 436.566L64.0831 441.656L57.8931 434.556L51.7531 434.886L52.6631 441.556L53.9831 454.236L45.8631 462.976L53.4031 468.626L24.9631 495.436L16.0331 497.606L18.6131 502.616L40.4631 506.956L151.973 471.226L177.373 447.336L207.613 426.236L184.453 424.586Z"
            fill="#000"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1262"
            d="M455.673 95.156L461.453 93.986L469.883 100.736L483.593 100.876L495.313 92.636L488.803 76.936L498.513 72.906L525.903 69.346L555.933 56.296L553.193 43.416L524.543 40.776L482.403 43.936L461.933 21.496L428.893 2.02596L407.813 0.865967L395.713 3.79597L359.133 5.09596L350.583 12.466L373.573 24.406L368.893 29.906L377.673 33.746L374.783 36.856L351.903 42.676L333.043 60.676L338.693 66.066L336.623 71.036L354.683 76.826L355.773 85.736L379.543 86.066L388.383 78.846L406.663 75.456L421.393 77.486L427.813 85.936L442.643 85.576L455.673 95.156Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1263"
            d="M141.053 429.516L137.893 430.316L141.053 429.516Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="karnataka"
            className={classes["map-loc"]}
            onMouseOver={onMouseOverHandler.bind(null, "karnataka")}
            onMouseOut={onMouseOutHandler}
            d="M50.7331 427.486L52.6631 441.556L51.7531 434.886L57.8931 434.556L64.0831 441.656L99.8131 436.566L112.873 424.226L132.353 425.276L142.793 421.956L139.083 405.656L117.053 404.256L116.503 400.726L129.773 397.796L129.503 394.306L113.923 392.156L121.233 384.286L134.783 381.056L139.943 375.856L135.853 374.056L142.453 369.546L161.673 369.316L166.103 365.416L165.373 359.146L187.003 338.626L193.573 337.286L197.533 332.566L194.503 330.676L197.613 327.316L163.603 330.786L144.453 336.446L124.623 333.706L103.873 340.206L88.0131 338.016L66.6931 346.006L70.6031 349.006L65.2231 353.776L52.5331 357.286L44.3431 370.046L33.8031 371.886L36.3731 384.016L18.9131 410.666L36.1431 414.286L38.6131 423.666L50.7331 427.486Z"
            fill="#000"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="maharashtra"
            className={classes["map-loc"]}
            onMouseOver={onMouseOverHandler.bind(null, "maharashtra")}
            onMouseOut={onMouseOutHandler}
            d="M84.583 275.736L122.033 270.296L139.123 263.946L145.273 251.676L154.043 250.086L168.363 254.836L174.643 264.576L198.173 268.486L204.203 275.076L219.363 277.336L241.823 271.396L253.003 272.776L249.323 279.826L256.963 280.886L270.483 276.996L281.813 278.566L285.753 282.236L294.253 283.406L304.093 280.896L318.103 282.836L320.273 286.016L342.833 290.286L328.993 308.266L318.413 315.516L321.263 320.016L316.793 324.826L299.633 329.196L293.173 337.406L281.973 333.416L293.543 319.066L287.933 315.986L275.903 318.106L265.533 315.856L262.073 309.946L253.713 308.796L239.043 313.916L223.053 313.926L210.223 324.736L197.613 327.316L163.603 330.786L144.453 336.446L124.623 333.706L103.873 340.206L88.013 338.016L66.693 346.006L70.603 349.006L65.223 353.776L52.533 357.286L39.923 353.486L30.293 355.326L27.583 342.516L84.583 275.736Z"
            fill="#000"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1266"
            d="M456.013 114.056L451.923 120.286H445.533L429.463 114.886L404.713 118.586L398.533 130.286L403.943 137.836L431.353 147.246L470.633 151.286L494.453 142.386L481.793 135.376L456.013 114.056Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1267"
            d="M285.523 113.186L288.863 118.996L302.883 120.936L293.673 130.836L312.083 133.386L314.873 142.066L309.523 147.826L316.263 152.786L311.043 158.396L314.413 161.816L328.523 160.566L326.613 165.886L336.913 168.736L334.023 171.846L341.953 172.936L348.543 179.606L342.853 185.726L356.263 188.836L347.973 193.166L331.953 191.836L289.883 199.506L289.243 207.526L307.823 211.376L303.873 215.626L288.763 214.176L286.533 216.576L286.573 221.346L274.223 230.166L268.413 229.366L263.523 224.826L257.153 223.946L235.263 229.956L229.743 229.196L233.333 225.336L247.343 219.706L251.003 213.886L235.113 214.186L241.753 207.046L237.113 204.926L222.733 209.406L205.193 228.276L182.233 236.476L162.393 215.866L168.833 204.806L129.523 197.656L112.153 189.136L117.263 181.896L99.2831 170.756L103.163 166.576L114.013 162.926L117.333 156.376L105.553 146.356L152.773 135.786L178.443 140.486L221.013 133.536L285.523 113.186Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="hr"
            className={classes["map-loc"]}
            onMouseOver={onMouseOverHandler.bind(null, "Haryana")}
            onMouseOut={onMouseOutHandler}
            d="M302.883 120.936L314.533 122.546L316.593 127.896L326.553 129.216L327.333 131.356L333.193 132.156L355.713 126.726L367.513 128.356L378.343 124.156L385.653 116.286L393.973 125.106L400.463 126.636L398.533 130.286L369.783 135.596L365.213 143.436L348.103 156.686L361.133 158.496L352.893 168.036L341.953 172.936L334.023 171.846L336.913 168.736L326.613 165.886L328.523 160.566L314.413 161.816L311.043 158.396L316.263 152.786L309.523 147.826L314.873 142.066L312.083 133.386L293.673 130.836L302.883 120.936Z"
            fill="#000"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1269"
            d="M285.523 113.186L288.863 118.996L314.533 122.546L316.593 127.896L326.553 129.216L327.333 131.356L333.193 132.156L355.713 126.726L367.513 128.356L378.343 124.156L385.653 116.286L382.333 107.826L371.523 103.206L377.753 96.5061L379.543 86.0661L355.773 85.7361L339.003 89.3461L325.153 103.096L300.583 106.616L285.523 113.186Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1270"
            d="M455.673 95.1561L442.643 85.576L427.813 85.9361L421.393 77.4861L406.663 75.4561L388.383 78.8461L379.543 86.0661L377.753 96.506L371.523 103.206L382.333 107.826L385.653 116.286L393.973 125.106L400.463 126.636L404.713 118.586L429.463 114.886L445.533 120.286H451.923L456.013 114.056L455.673 95.1561Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1271"
            d="M708.493 234.636L686.013 244.376L689.403 249.446L731.573 254.506L754.373 251.516L768.823 253.626L763.533 260.456L772.253 265.056L767.203 270.496L753.333 278.996L752.583 278.856L752.343 280.066L735.233 283.626L742.023 287.736L754.953 287.106L761.553 282.756L770.433 283.986L780.833 273.476L796.713 271.446L799.983 260.556L819.783 258.856L857.753 245.856L878.453 246.736L892.423 241.326L896.673 231.826L893.233 228.996L870.073 232.596L851.813 230.236L835.113 235.816L802.393 238.366L716.513 236.206L708.493 234.636Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1272"
            d="M679.193 228.906L683.013 223.436L652.993 222.656L645.713 230.196L637.583 230.866L643.923 236.256L631.183 241.016L610.323 266.906L592.073 268.656L588.143 272.886L577.843 276.066L542.843 274.516L534.673 280.896L548.303 288.586L542.613 302.266L559.043 308.316L560.583 313.136L585.933 307.926L591.563 311.496L618.273 306.146L620.113 287.656L635.023 271.966L623.373 265.586L627.973 260.626L652.013 255.406L645.733 242.096L650.493 237.166L651.613 236.006L684.323 241.836L686.013 244.376L708.493 234.636L679.193 228.906Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1273"
            d="M652.993 222.656L683.013 223.436L690.823 212.266L682.733 206.876L663.063 212.216L652.993 222.656Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="madhya-pardesh"
            className={classes["map-loc"]}
            onMouseOver={onMouseOverHandler.bind(null, "Madhya Pradesh")}
            onMouseOut={onMouseOutHandler}
            d="M182.233 236.476L205.193 228.276L222.733 209.406L237.113 204.926L241.753 207.046L235.113 214.186L251.003 213.886L247.343 219.706L233.333 225.336L229.743 229.196L235.263 229.956L257.153 223.946L263.523 224.826L268.413 229.366L274.223 230.166L286.573 221.346L286.533 216.576L288.763 214.176L303.873 215.626L307.823 211.376L289.243 207.526L289.883 199.506L331.953 191.836L347.973 193.166L356.263 188.836L372.113 191.026L377.543 200.546L370.773 207.826L332.243 214.676L324.723 222.076L323.273 228.226L332.223 236.696L339.783 237.746L343.573 233.666L337.713 222.766L345.983 215.476L358.903 216.706L372.243 223.896L380.173 224.996L389.413 223.476L401.273 229.636L440.613 234.466L447.193 244.586L457.753 248.126L455.463 252.196L446.063 254.516L442.893 257.476L459.883 259.816L467.323 257.426L478.073 267.866L482.043 278.606L479.293 281.576L467.103 284.606L463.313 288.676L437.803 294.576L429.493 303.516L421.503 305.696L406.393 303.616L386.943 310.786L389.493 323.636L379.853 327.126L373.363 319.436L362.853 323.876L360.643 335.876L351.663 341.866L342.833 341.746L312.303 355.126L301.773 353.826L293.173 337.406L299.633 329.196L316.793 324.826L321.263 320.016L318.413 315.516L328.993 308.266L342.833 290.286L320.273 286.016L318.103 282.836L304.093 280.896L294.253 283.406L285.753 282.236L281.813 278.566L270.483 276.996L256.963 280.886L249.323 279.826L253.003 272.776L241.823 271.396L219.363 277.336L204.203 275.076L198.173 268.486L174.643 264.576L168.363 254.836L154.043 250.086L162.213 248.616L182.233 236.476Z"
            fill="#000"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1276"
            d="M945.543 235.296L931.063 224.746L929.673 206.636L886.633 204.466L798.033 220.006L771.893 221.656L764.903 226.776L779.053 232.186L770.373 237.396L802.393 238.366L835.113 235.816L851.813 230.236L870.073 232.596L893.233 228.996L896.673 231.826L892.423 241.326L878.453 246.736L886.953 247.096L927.613 245.636L945.543 235.296Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1277"
            d="M359.083 148.186L367.953 151.836L361.133 158.496L348.103 156.686L359.083 148.186Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1278"
            d="M522.443 217.716L536.413 214.606L526.793 208.456L530.283 202.736L525.823 202.616L504.613 197.936L467.753 176.616L445.993 167.476L453.333 157.746L470.633 151.286L431.353 147.246L403.943 137.836L398.533 130.286L369.783 135.596L365.213 143.436L348.103 156.686L359.083 148.186L367.953 151.836L361.133 158.496L352.893 168.036L341.953 172.936L348.543 179.606L342.853 185.726L356.263 188.836L372.113 191.026L377.543 200.546L370.773 207.826L332.243 214.676L324.723 222.076L323.273 228.226L332.223 236.696L339.783 237.746L343.573 233.666L337.713 222.766L345.983 215.476L358.903 216.706L372.243 223.896L380.173 224.996L389.413 223.476L401.273 229.636L440.613 234.466L447.193 244.586L457.753 248.126L455.463 252.196L446.063 254.516L442.883 257.476L459.883 259.816L467.323 257.426L480.743 248.996L483.963 244.676L481.033 241.646L485.873 237.296L494.223 238.456L513.683 233.106L523.753 233.736L526.323 230.966L517.393 223.156L522.443 217.716Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="andhra-pradesh"
            className={classes["map-loc"]}
            onMouseOver={onMouseOverHandler.bind(null, "Andhra Pradesh")}
            onMouseOut={onMouseOutHandler}
            d="M161.673 369.316L179.833 374.546L191.243 370.966L202.413 373.166L218.873 371.056L227.133 366.286L247.933 367.506L253.703 363.486L259.963 363.856L262.753 369.446L270.343 367.706L266.923 364.266L272.863 363.616L280.823 365.476L296.893 363.316L299.473 360.546L291.603 357.326L293.143 353.376L301.773 353.826L293.173 337.406L281.973 333.416L293.543 319.066L287.933 315.986L275.903 318.106L265.533 315.856L262.073 309.946L253.713 308.796L239.043 313.916L223.053 313.926L210.223 324.736L197.613 327.316L194.503 330.676L197.533 332.566L193.573 337.286L187.003 338.626L165.373 359.146L166.103 365.416L161.673 369.316Z"
            fill="#000"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="kerla"
            className={classes["map-loc"]}
            onMouseOver={onMouseOverHandler.bind(null, "Kerala")}
            onMouseOut={onMouseOutHandler}
            d="M45.8631 462.976L53.9831 454.236L52.6631 441.556L50.7331 427.486L38.6131 423.666L36.1431 414.286L18.9131 410.666L13.9931 418.186L20.2731 465.526L6.91309 479.896L16.0331 497.606L24.9631 495.436L53.4031 468.626L45.8631 462.976Z"
            fill="#000"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
          <path
            id="Path 1252"
            d="M33.803 371.886L44.343 370.046L52.533 357.286L39.923 353.486L30.293 355.326L33.803 371.886Z"
            stroke="white"
            strokeWidth="1.72"
            strokeMiterlimit="10"
          />
        </g>
      </svg>
    </div>
  );
});

export default AreaMap;
